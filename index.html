<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XTributation - Plataforma Unificada</title>
    <!-- Dependências e Estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@100..800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">

    <!-- Dependências para o Resumo Anual Aprimorado -->
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body class="antialiased" style="overflow: hidden;">

    <!-- ======================================================================= -->
    <!-- TELAS DE AUTENTICAÇÃO E ACESSO -->
    <!-- ======================================================================= -->

    <div id="login-screen" style="display: flex; flex-direction: column; align-items: center;">
        <!-- Logo no topo da página -->
        <div style="margin-top: 1rem; margin-bottom: 3rem; position: fixed; top: 0;">
            <svg width="187" height="27" viewBox="0 0 187 27" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0_92_194)">
            <path d="M44.1104 26.5309V0.544922H56.7635C59.6925 0.544922 61.9702 1.21414 63.5968 2.55258C65.2233 3.89103 66.0366 5.89675 66.0366 8.56974C66.0399 9.802 65.7699 11.0198 65.2458 12.1363C64.7239 13.2569 63.926 14.2281 62.926 14.9599C61.8304 15.7443 60.5465 16.2277 59.2033 16.3615L59.2443 14.6131L67.381 26.5338H60.4247L53.2634 15.0386L55.7471 17.1424H49.6432V26.5309H44.1104ZM49.6432 13.0513H55.5831C57.0476 13.0513 58.1733 12.7133 58.9602 12.0373C59.7471 11.3612 60.1377 10.2928 60.1318 8.83199C60.1318 7.5324 59.8057 6.53294 59.1535 5.83361C58.5014 5.13428 57.4713 4.78364 56.0635 4.7817H49.6432V13.0513Z" fill="white"/>
            <path d="M68.9861 26.5309L79.3986 0.544922H85.3795L95.338 26.5309H89.609L80.74 2.33113L83.1828 2.09802L74.3549 26.5309H68.9861ZM74.475 20.1815L75.8194 16.1283H88.4286L88.9177 20.1815H74.475Z" fill="white"/>
            <path d="M96.949 26.5309V0.544922H107.159C111.662 0.544922 114.991 1.63568 117.147 3.81721C119.303 5.99873 120.377 9.23217 120.369 13.5175C120.369 17.8048 119.295 21.045 117.147 23.2382C114.999 25.4314 111.67 26.5289 107.159 26.5309H96.949ZM102.482 22.2854H106.55C109.284 22.2854 111.334 21.5841 112.701 20.1815C114.068 18.779 114.745 16.5577 114.734 13.5175C114.734 10.4812 114.056 8.26087 112.701 6.85638C111.346 5.45189 109.296 4.75062 106.55 4.75256H102.482V22.2854Z" fill="white"/>
            <path d="M122.85 26.5309V0.544922H141.033V4.79336H128.421V11.3642H139.419V15.6621H128.382V22.2854H141.033V26.5309H122.85Z" fill="white"/>
            <path d="M143.502 26.5309V0.544922H156.152C159.081 0.544922 161.359 1.21414 162.985 2.55258C164.612 3.89103 165.426 5.89675 165.428 8.56974C165.43 9.80221 165.159 11.02 164.634 12.1363C164.113 13.2569 163.315 14.2281 162.315 14.9599C161.219 15.7443 159.935 16.2277 158.592 16.3615L158.633 14.6131L166.77 26.5338H159.813L152.655 15.0386L155.136 17.1424H149.032V26.5309H143.502ZM149.032 13.0513H154.972C156.436 13.0513 157.562 12.7133 158.349 12.0373C159.136 11.3612 159.526 10.2928 159.52 8.83199C159.52 7.5324 159.194 6.53294 158.542 5.83361C157.89 5.13428 156.86 4.78364 155.452 4.7817H149.032V13.0513Z" fill="white"/>
            <path d="M177.496 26.9996C176.274 27.0079 175.054 26.9437 173.84 26.8073C172.84 26.6917 171.852 26.4829 170.891 26.1838C169.97 25.8874 169.073 25.5222 168.208 25.0911V19.9481C169.416 20.8672 170.774 21.572 172.223 22.0315C173.734 22.5335 175.317 22.7903 176.91 22.792C178.374 22.792 179.479 22.5123 180.225 21.9528C180.594 21.6747 180.889 21.311 181.084 20.8935C181.279 20.476 181.368 20.0174 181.344 19.5576C181.355 19.1837 181.277 18.8126 181.118 18.474C180.958 18.1354 180.72 17.8389 180.424 17.6082C179.696 17.0495 178.881 16.6134 178.011 16.3174C177.007 15.9541 175.909 15.5772 174.716 15.1868C173.874 14.9012 173.054 14.5836 172.256 14.2339C171.473 13.8944 170.746 13.4418 170.097 12.8906C169.448 12.3273 168.929 11.6316 168.574 10.8509C168.166 9.89654 167.972 8.86568 168.003 7.82923C168.006 6.85337 168.2 5.88745 168.574 4.98529C168.971 4.0259 169.57 3.16241 170.331 2.45313C171.212 1.64488 172.257 1.03381 173.395 0.661093C174.831 0.193798 176.336 -0.0298055 177.847 -0.000357685C178.82 -0.0106172 179.793 0.0546574 180.755 0.194872C181.558 0.318803 182.348 0.513837 183.116 0.777648C183.86 1.0399 184.654 1.36042 185.495 1.7538V6.89679C184.844 6.45388 184.153 6.03137 183.421 5.62926C182.675 5.22094 181.89 4.88806 181.078 4.63562C180.201 4.36821 179.291 4.22403 178.374 4.20728C177.522 4.16544 176.669 4.27093 175.852 4.51907C175.218 4.70495 174.653 5.07047 174.224 5.57098C173.841 6.04515 173.64 6.63872 173.656 7.24646C173.638 7.5991 173.691 7.95172 173.814 8.28319C173.936 8.61466 174.124 8.91814 174.367 9.17545C174.929 9.71049 175.602 10.1155 176.339 10.3614C177.18 10.6742 178.13 10.9859 179.188 11.2967C180.208 11.5966 181.212 11.9477 182.197 12.3487C183.092 12.7088 183.934 13.1871 184.701 13.7706C185.416 14.3282 185.994 15.042 186.388 15.857C186.82 16.8109 187.029 17.8502 186.997 18.8961C187.008 20.3062 186.651 21.6949 185.96 22.926C185.226 24.2007 184.13 25.2308 182.809 25.8865C181.399 26.6267 179.628 26.9977 177.496 26.9996Z" fill="white"/>
            <path d="M0 26.5542L10.9924 12.2908L13.0075 16.752L5.83158 26.5542H0ZM16.2939 26.5542L11.0979 15.3824L3.99511 0.553711H9.71832L15.0549 12.0431L21.9819 26.5542H16.2939ZM15.0198 15.0998L13.0075 10.7086L20.5028 0.553711H26.3314L15.0198 15.0998Z" fill="white"/>
            <path d="M28.3699 26.5368V4.79923H20.5027V0.553711H41.6469V4.79923H33.683V26.5368H28.3699Z" fill="white"/>
            </g>
            <defs>
            <clipPath id="clip0_92_194">
            <rect width="187" height="27" fill="white"/>
            </clipPath>
            </defs>
            </svg>
        </div>
        
        <div class="login-box">
            <div class="mx-auto mb-8 inline-block">
                <svg class="w-20 h-auto inline-block" viewBox="0 0 59.0 45.6" xmlns="http://www.w3.org/2000/svg">
                    <path class="logo-path" d="M4.76369 -0.719727C2.13278 -0.719727 0 1.41305 0 4.04396V4.04396C0.00217239 3.70526 0.105853 3.37498 0.297665 3.09573C0.489477 2.81649 0.760619 2.60109 1.07611 2.47733C1.3916 2.35357 1.73695 2.32713 2.06762 2.40142C2.39829 2.47571 2.6991 2.64732 2.93124 2.89411L12.335 12.8644C13.2797 13.866 14.5956 14.4337 15.9724 14.4337H25.321C25.7157 14.4314 26.1025 14.5448 26.4334 14.7599C26.7644 14.975 27.0249 15.2823 27.1829 15.6438C27.3409 16.0054 27.3894 16.4053 27.3224 16.794C27.2553 17.1828 27.0757 17.5434 26.8058 17.8313L2.93398 43.2184C2.70202 43.4662 2.40099 43.6387 2.06985 43.7135C1.7387 43.7884 1.3927 43.7622 1.07662 43.6383C0.760551 43.5144 0.488961 43.2986 0.297012 43.0187C0.105064 42.7389 0.00159475 42.4079 0 42.0686V42.0686C0 44.6587 2.09968 46.7584 4.68977 46.7584H55.1698C57.9313 46.7584 60.1698 44.5198 60.1698 41.7584V4.28028C60.1698 1.51886 57.9313 -0.719727 55.1698 -0.719727H4.76369ZM18.297 1.59641C18.1396 1.42755 18.0354 1.2162 17.9972 0.988633C17.9591 0.761063 17.9887 0.527307 18.0824 0.316417C18.1761 0.105528 18.3297 -0.073197 18.5242 -0.197543C18.7187 -0.321889 18.9455 -0.386374 19.1763 -0.382983H40.9415C41.1711 -0.38424 41.3961 -0.318396 41.5888 -0.193551C41.7814 -0.0687055 41.9334 0.109697 42.026 0.319715C42.1185 0.529733 42.1476 0.762208 42.1097 0.988546C42.0718 1.21488 41.9686 1.42522 41.8126 1.59367L32.5669 11.5153C32.2486 11.8553 31.8638 12.1264 31.4364 12.3117C31.009 12.497 30.5481 12.5926 30.0822 12.5926C29.6163 12.5926 29.1553 12.497 28.7279 12.3117C28.3005 12.1264 27.9158 11.8553 27.5975 11.5153L18.297 1.59641ZM40.9196 46.501C40.9196 46.498 40.9171 46.4955 40.914 46.4955H19.1544C18.9243 46.4973 18.6986 46.4316 18.5054 46.3066C18.3122 46.1817 18.1598 46.0029 18.0671 45.7923C17.9745 45.5817 17.9455 45.3487 17.984 45.1219C18.0224 44.8951 18.1264 44.6845 18.2833 44.5161L27.5208 34.5973C27.8391 34.2572 28.2238 33.9862 28.6512 33.8008C29.0786 33.6155 29.5396 33.5199 30.0055 33.5199C30.4714 33.5199 30.9323 33.6155 31.3597 33.8008C31.7871 33.9862 32.1719 34.2572 32.4902 34.5973L41.788 44.5216C41.9465 44.6896 42.052 44.9004 42.0916 45.1279C42.1311 45.3553 42.1028 45.5894 42.0103 45.8009C41.9177 46.0125 41.765 46.1921 41.5711 46.3176C41.3786 46.442 41.1541 46.5077 40.925 46.5065C40.922 46.5065 40.9196 46.5041 40.9196 46.501V46.501ZM60.0959 42.0686C60.0937 42.4073 59.99 42.7376 59.7982 43.0168C59.6064 43.2961 59.3353 43.5115 59.0198 43.6352C58.7043 43.759 58.3589 43.7854 58.0283 43.7111C57.6976 43.6368 57.3968 43.4652 57.1646 43.2184L47.7636 33.2486C46.8189 32.2467 45.5029 31.6788 44.1259 31.6788H34.7776C34.3827 31.6809 33.9957 31.5673 33.6646 31.3521C33.3335 31.1369 33.0727 30.8294 32.9145 30.4678C32.7563 30.1061 32.7075 29.706 32.7743 29.3169C32.841 28.9279 33.0204 28.5669 33.2901 28.2785L57.1537 2.90506C57.3851 2.65704 57.6857 2.48423 58.0166 2.40904C58.3475 2.33386 58.6933 2.35977 59.0093 2.48342C59.3252 2.60707 59.5967 2.82274 59.7885 3.10247C59.9803 3.3822 60.0836 3.71307 60.0849 4.05217L60.0959 42.0686Z"/>
                </svg>
            </div>
            
            <h1 class="text-3xl font-semibold mb-3 text-text-primary">Método Definitivo de Tributação - Mercado Americano</h1>
            <p class="text-base text-text-secondary mb-6"></p>
            
            <form class="space-y-4">
                <input type="email" id="email-input" placeholder="Seu e-mail" class="input-field">
                <div class="password-container">
                    <input type="password" id="password-input" placeholder="Sua senha" class="input-field">
                    <button type="button" id="toggle-login-password" class="password-toggle" aria-label="Mostrar ou ocultar senha">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                    </button>
                </div>
                
                <button type="button" id="sign-in-button" class="mt-6 btn btn-primary w-full text-base py-3">
                    <span>Entrar</span>
                </button>
            </form>
            
            <div class="mt-6 text-sm text-text-secondary">
                É seu primeiro acesso? 
                <a href="#" id="go-to-register-link" class="font-semibold text-accent-primary hover:text-accent-hover transition-colors duration-200">
                    Crie sua conta aqui.
                </a>
            </div>
            
            <div class="mt-4 text-sm">
                <a href="#" id="forgot-password-link" class="text-text-secondary hover:text-accent-primary transition-colors duration-200">
                    Esqueceu a senha?
                </a>
            </div>
            
            <p id="login-message" class="message"></p>
        </div>
    </div>

    <div id="register-screen" style="display: none;">
        <div class="login-box">
            <div class="mx-auto mb-8">
                <svg class="w-20 h-auto inline-block" viewBox="0 0 60 46.4" xmlns="http://www.w3.org/2000/svg">
                    <path class="logo-path" d="M4.76369 -0.719727C2.13278 -0.719727 0 1.41305 0 4.04396V4.04396C0.00217239 3.70526 0.105853 3.37498 0.297665 3.09573C0.489477 2.81649 0.760619 2.60109 1.07611 2.47733C1.3916 2.35357 1.73695 2.32713 2.06762 2.40142C2.39829 2.47571 2.6991 2.64732 2.93124 2.89411L12.335 12.8644C13.2797 13.866 14.5956 14.4337 15.9724 14.4337H25.321C25.7157 14.4314 26.1025 14.5448 26.4334 14.7599C26.7644 14.975 27.0249 15.2823 27.1829 15.6438C27.3409 16.0054 27.3894 16.4053 27.3224 16.794C27.2553 17.1828 27.0757 17.5434 26.8058 17.8313L2.93398 43.2184C2.70202 43.4662 2.40099 43.6387 2.06985 43.7135C1.7387 43.7884 1.3927 43.7622 1.07662 43.6383C0.760551 43.5144 0.488961 43.2986 0.297012 43.0187C0.105064 42.7389 0.00159475 42.4079 0 42.0686V42.0686C0 44.6587 2.09968 46.7584 4.68977 46.7584H55.1698C57.9313 46.7584 60.1698 44.5198 60.1698 41.7584V4.28028C60.1698 1.51886 57.9313 -0.719727 55.1698 -0.719727H4.76369ZM18.297 1.59641C18.1396 1.42755 18.0354 1.2162 17.9972 0.988633C17.9591 0.761063 17.9887 0.527307 18.0824 0.316417C18.1761 0.105528 18.3297 -0.073197 18.5242 -0.197543C18.7187 -0.321889 18.9455 -0.386374 19.1763 -0.382983H40.9415C41.1711 -0.38424 41.3961 -0.318396 41.5888 -0.193551C41.7814 -0.0687055 41.9334 0.109697 42.026 0.319715C42.1185 0.529733 42.1476 0.762208 42.1097 0.988546C42.0718 1.21488 41.9686 1.42522 41.8126 1.59367L32.5669 11.5153C32.2486 11.8553 31.8638 12.1264 31.4364 12.3117C31.009 12.497 30.5481 12.5926 30.0822 12.5926C29.6163 12.5926 29.1553 12.497 28.7279 12.3117C28.3005 12.1264 27.9158 11.8553 27.5975 11.5153L18.297 1.59641Z"/>
                </svg>
            </div>
            
            <h1 class="text-3xl font-semibold mb-3 text-text-primary">Criar Nova Conta</h1>
            <p class="text-base text-text-secondary mb-8">Use o mesmo e-mail que você utilizou na compra.</p>
            
            <div class="space-y-4">
                <input type="email" id="register-email-input" placeholder="Seu e-mail" class="input-field">
                <div class="password-container">
                    <input type="password" id="register-password-input" placeholder="Crie uma senha (mín. 6 caracteres)" class="input-field">
                    <button type="button" id="toggle-register-password" class="password-toggle" aria-label="Mostrar ou ocultar senha">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                    </button>
                </div>
                <div class="password-container">
                    <input type="password" id="register-confirm-password-input" placeholder="Confirme sua senha" class="input-field">
                    <button type="button" id="toggle-confirm-password" class="password-toggle" aria-label="Mostrar ou ocultar senha">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                    </button>
                </div>
            </div>
            
            <button id="register-button" class="mt-6 btn btn-primary w-full text-base py-3">
                <span>Cadastrar e Acessar</span>
            </button>
            
            <div class="mt-6 text-sm">
                <a href="#" id="go-to-login-link" class="font-semibold text-accent-primary hover:text-accent-hover transition-colors duration-200">Já tem uma conta? Acesse aqui.</a>
            </div>
            
            <p id="register-message" class="message"></p>
        </div>
    </div>

    <div id="no-access-screen" style="display: none;">
        <div class="login-box">
            <h2 class="text-3xl font-semibold mb-3 text-text-primary">Acesso Negado</h2>
            <p class="text-base text-text-secondary mb-8">
                Não encontramos um pagamento ativo para esta conta. Por favor, verifique o status da sua compra ou entre em contato com o suporte.
            </p>
            <button id="logout-from-no-access" class="mt-6 btn btn-danger w-full text-base py-3">
                <span>Sair</span>
            </button>
        </div>
    </div>

    <div id="loading-overlay" style="display: flex; opacity: 1;">
        <div class="text-center">
             <svg class="w-20 h-auto inline-block" viewBox="0 0 60 45.6" xmlns="http://www.w3.org/2000/svg">
                <path class="logo-path" d="M4.76369 -0.719727C2.13278 -0.719727 0 1.41305 0 4.04396V4.04396C0.00217239 3.70526 0.105853 3.37498 0.297665 3.09573C0.489477 2.81649 0.760619 2.60109 1.07611 2.47733C1.3916 2.35357 1.73695 2.32713 2.06762 2.40142C2.39829 2.47571 2.6991 2.64732 2.93124 2.89411L12.335 12.8644C13.2797 13.866 14.5956 14.4337 15.9724 14.4337H25.321C25.7157 14.4314 26.1025 14.5448 26.4334 14.7599C26.7644 14.975 27.0249 15.2823 27.1829 15.6438C27.3409 16.0054 27.3894 16.4053 27.3224 16.794C27.2553 17.1828 27.0757 17.5434 26.8058 17.8313L2.93398 43.2184C2.70202 43.4662 2.40099 43.6387 2.06985 43.7135C1.7387 43.7884 1.3927 43.7622 1.07662 43.6383C0.760551 43.5144 0.488961 43.2986 0.297012 43.0187C0.105064 42.7389 0.00159475 42.4079 0 42.0686V42.0686C0 44.6587 2.09968 46.7584 4.68977 46.7584H55.1698C57.9313 46.7584 60.1698 44.5198 60.1698 41.7584V4.28028C60.1698 1.51886 57.9313 -0.719727 55.1698 -0.719727H4.76369ZM18.297 1.59641C18.1396 1.42755 18.0354 1.2162 17.9972 0.988633C17.9591 0.761063 17.9887 0.527307 18.0824 0.316417C18.1761 0.105528 18.3297 -0.073197 18.5242 -0.197543C18.7187 -0.321889 18.9455 -0.386374 19.1763 -0.382983H40.9415C41.1711 -0.38424 41.3961 -0.318396 41.5888 -0.193551C41.7814 -0.0687055 41.9334 0.109697 42.026 0.319715C42.1185 0.529733 42.1476 0.762208 42.1097 0.988546C42.0718 1.21488 41.9686 1.42522 41.8126 1.59367L32.5669 11.5153C32.2486 11.8553 31.8638 12.1264 31.4364 12.3117C31.009 12.497 30.5481 12.5926 30.0822 12.5926C29.6163 12.5926 29.1553 12.497 28.7279 12.3117C28.3005 12.1264 27.9158 11.8553 27.5975 11.5153L18.297 1.59641ZM40.9196 46.501C40.9196 46.498 40.9171 46.4955 40.914 46.4955H19.1544C18.9243 46.4973 18.6986 46.4316 18.5054 46.3066C18.3122 46.1817 18.1598 46.0029 18.0671 45.7923C17.9745 45.5817 17.9455 45.3487 17.984 45.1219C18.0224 44.8951 18.1264 44.6845 18.2833 44.5161L27.5208 34.5973C27.8391 34.2572 28.2238 33.9862 28.6512 33.8008C29.0786 33.6155 29.5396 33.5199 30.0055 33.5199C30.4714 33.5199 30.9323 33.6155 31.3597 33.8008C31.7871 33.9862 32.1719 34.2572 32.4902 34.5973L41.788 44.5216C41.9465 44.6896 42.052 44.9004 42.0916 45.1279C42.1311 45.3553 42.1028 45.5894 42.0103 45.8009C41.9177 46.0125 41.765 46.1921 41.5711 46.3176C41.3786 46.442 41.1541 46.5077 40.925 46.5065C40.922 46.5065 40.9196 46.5041 40.9196 46.501V46.501ZM60.0959 42.0686C60.0937 42.4073 59.99 42.7376 59.7982 43.0168C59.6064 43.2961 59.3353 43.5115 59.0198 43.6352C58.7043 43.759 58.3589 43.7854 58.0283 43.7111C57.6976 43.6368 57.3968 43.4652 57.1646 43.2184L47.7636 33.2486C46.8189 32.2467 45.5029 31.6788 44.1259 31.6788H34.7776C34.3827 31.6809 33.9957 31.5673 33.6646 31.3521C33.3335 31.1369 33.0727 30.8294 32.9145 30.4678C32.7563 30.1061 32.7075 29.706 32.7743 29.3169C32.841 28.9279 33.0204 28.5669 33.2901 28.2785L57.1537 2.90506C57.3851 2.65704 57.6857 2.48423 58.0166 2.40904C58.3475 2.33386 58.6933 2.35977 59.0093 2.48342C59.3252 2.60707 59.5967 2.82274 59.7885 3.10247C59.9803 3.3822 60.0836 3.71307 60.0849 4.05217L60.0959 42.0686Z"/>
            </svg>
            <p id="loading-message" class="text-text-secondary mt-4">Carregando plataforma...</p>
        </div>
    </div>

    <!-- ======================================================================= -->
    <!-- CONTEÚDO PRINCIPAL DA APLICAÇÃO -->
    <!-- ======================================================================= -->

    <div id="calculator-content" style="display: none;">
        <div class="content-wrapper">
            <header class="mb-12 flex justify-between items-start relative stagger-in no-print" style="--stagger-index: 0;">
                <div class="flex items-center gap-4">
                    <svg class="w-14 h-auto flex-shrink-0" viewBox="0 0 59.3 45.9" xmlns="http://www.w3.org/2000/svg">
                        <path class="logo-path" d="M4.76369 -0.719727C2.13278 -0.719727 0 1.41305 0 4.04396V4.04396C0.00217239 3.70526 0.105853 3.37498 0.297665 3.09573C0.489477 2.81649 0.760619 2.60109 1.07611 2.47733C1.3916 2.35357 1.73695 2.32713 2.06762 2.40142C2.39829 2.47571 2.6991 2.64732 2.93124 2.89411L12.335 12.8644C13.2797 13.866 14.5956 14.4337 15.9724 14.4337H25.321C25.7157 14.4314 26.1025 14.5448 26.4334 14.7599C26.7644 14.975 27.0249 15.2823 27.1829 15.6438C27.3409 16.0054 27.3894 16.4053 27.3224 16.794C27.2553 17.1828 27.0757 17.5434 26.8058 17.8313L2.93398 43.2184C2.70202 43.4662 2.40099 43.6387 2.06985 43.7135C1.7387 43.7884 1.3927 43.7622 1.07662 43.6383C0.760551 43.5144 0.488961 43.2986 0.297012 43.0187C0.105064 42.7389 0.00159475 42.4079 0 42.0686V42.0686C0 44.6587 2.09968 46.7584 4.68977 46.7584H55.1698C57.9313 46.7584 60.1698 44.5198 60.1698 41.7584V4.28028C60.1698 1.51886 57.9313 -0.719727 55.1698 -0.719727H4.76369ZM18.297 1.59641C18.1396 1.42755 18.0354 1.2162 17.9972 0.988633C17.9591 0.761063 17.9887 0.527307 18.0824 0.316417C18.1761 0.105528 18.3297 -0.073197 18.5242 -0.197543C18.7187 -0.321889 18.9455 -0.386374 19.1763 -0.382983H40.9415C41.1711 -0.38424 41.3961 -0.318396 41.5888 -0.193551C41.7814 -0.0687055 41.9334 0.109697 42.026 0.319715C42.1185 0.529733 42.1476 0.762208 42.1097 0.988546C42.0718 1.21488 41.9686 1.42522 41.8126 1.59367L32.5669 11.5153C32.2486 11.8553 31.8638 12.1264 31.4364 12.3117C31.009 12.497 30.5481 12.5926 30.0822 12.5926C29.6163 12.5926 29.1553 12.497 28.7279 12.3117C28.3005 12.1264 27.9158 11.8553 27.5975 11.5153L18.297 1.59641ZM40.9196 46.501C40.9196 46.498 40.9171 46.4955 40.914 46.4955H19.1544C18.9243 46.4973 18.6986 46.4316 18.5054 46.3066C18.3122 46.1817 18.1598 46.0029 18.0671 45.7923C17.9745 45.5817 17.9455 45.3487 17.984 45.1219C18.0224 44.8951 18.1264 44.6845 18.2833 44.5161L27.5208 34.5973C27.8391 34.2572 28.2238 33.9862 28.6512 33.8008C29.0786 33.6155 29.5396 33.5199 30.0055 33.5199C30.4714 33.5199 30.9323 33.6155 31.3597 33.8008C31.7871 33.9862 32.1719 34.2572 32.4902 34.5973L41.788 44.5216C41.9465 44.6896 42.052 44.9004 42.0916 45.1279C42.1311 45.3553 42.1028 45.5894 42.0103 45.8009C41.9177 46.0125 41.765 46.1921 41.5711 46.3176C41.3786 46.442 41.1541 46.5077 40.925 46.5065C40.922 46.5065 40.9196 46.5041 40.9196 46.501V46.501ZM60.0959 42.0686C60.0937 42.4073 59.99 42.7376 59.7982 43.0168C59.6064 43.2961 59.3353 43.5115 59.0198 43.6352C58.7043 43.759 58.3589 43.7854 58.0283 43.7111C57.6976 43.6368 57.3968 43.4652 57.1646 43.2184L47.7636 33.2486C46.8189 32.2467 45.5029 31.6788 44.1259 31.6788H34.7776C34.3827 31.6809 33.9957 31.5673 33.6646 31.3521C33.3335 31.1369 33.0727 30.8294 32.9145 30.4678C32.7563 30.1061 32.7075 29.706 32.7743 29.3169C32.841 28.9279 33.0204 28.5669 33.2901 28.2785L57.1537 2.90506C57.3851 2.65704 57.6857 2.48423 58.0166 2.40904C58.3475 2.33386 58.6933 2.35977 59.0093 2.48342C59.3252 2.60707 59.5967 2.82274 59.7885 3.10247C59.9803 3.3822 60.0836 3.71307 60.0849 4.05217L60.0959 42.0686Z"/>
                    </svg>
                    <div class="page-title"> 
                        <h1 class="text-2xl font-regular text-text-primary ">Método Definitivo de Tributação</h1> 
                        <h5 class="text-1xl font-regular text-text-primary">Mercado Americano</h5> 
                    </div> 
                </div> 
                <button id="open-tutorial-button" class="btn btn-secondary !p-2.5 no-print" title="Abrir tutorial" aria-label="Abrir tutorial da plataforma">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                </button>
            </header>

            <nav class="flex justify-center mb-12 no-print">
                <div id="tour-step-1" class="tab-container">
                    <div id="active-tab-slider"></div>
                    <button id="main-tab-cambial" class="main-tab-button active">Envios e Retiradas</button>
                    <button id="main-tab-ir" class="main-tab-button">Apuração Anual de Resultados</button>
                    <button id="main-tab-wrapped" class="main-tab-button">XTRADERS WRAPPED</button>
                </div>
            </nav>

            <main>
                <div id="main-content-cambial" class="main-content">
                    <section id="cambial-input-area" class="space-y-6 no-print">
                        <div id="tour-step-2" class="card">
                            <h3 class="text-lg font-semibold mb-4 text-text-primary">Adicionar Transação de Capital</h3>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                                <div><label for="trans-date" class="block text-xs font-medium mb-1 text-text-secondary">Data</label><input type="date" id="trans-date" class="input-field h-12"></div>
                                <div><label for="trans-type" class="block text-xs font-medium mb-1 text-text-secondary">Tipo</label><select id="trans-type" class="input-field h-12"><option value="Envio">Envio</option><option value="Retirada">Retirada</option><option value="Não Retirada" id="nao-retirada-option" disabled>Não Retirada</option></select></div>
                                <div><label for="trans-value" class="block text-xs font-medium mb-1 text-text-secondary">Valor Líquido (USD)</label><input type="text" id="trans-value" placeholder="1.000,00" class="input-field h-12"></div>
                                <div class="flex gap-2">
                                    <button id="add-trans-button" class="btn btn-secondary w-full h-12">Adicionar +</button>
                                    <button id="cancel-edit-button" class="btn btn-secondary w-full hidden h-12" style="border-color: var(--warning-color); color: var(--warning-color);">Cancelar</button>
                                </div>
                            </div>
                            <div class="important-note">
                                <p>MUITO IMPORTANTE:</p>
                                <p class="mt-1 text-sm">NÃO CONSIDERAR OU INFORMAR RETIRADAS DE LUCRO COM OS SEUS TRADES NESTE CAMPO. AQUI DEVE-SE INFORMAR SOMENTE O CAPITAL ORIGINALMENTE ENVIADO OU RETIRADO DO EXTERIOR (MARGEM PARA OPERAR).</p>
                            </div>
                            <div id="transactions-list" class="mt-6"></div>
                        </div>
                        <div id="tour-step-4" class="text-center ">
                            <button id="process-cambial-button" class="btn btn-primary text-base py-2 px-8">
                             <span>Processar Dados</span>
                            </button>
                        </div>
                    </section>

                    <section id="results-area-cambial" class="transition-opacity duration-500 mt-12">
                        <!-- O CONTEÚDO SERÁ INJETADO AQUI PELO JAVASCRIPT -->
                    </section>
                </div>

                <div id="main-content-ir" class="main-content hidden">
                    <section id="tour-step-5" class="card no-print">
                        <h2 class="text-xl font-semibold mb-6 text-text-primary text-center">Apuração Anual de Resultados dos Trades</h2>
                        <p class="text-center text-sm mb-6 -mt-4 text-text-secondary">Importe a Planilha de Trades realizados para calcular seus resultados e impostos devidos.</p>
                        <div id="alert-box" class="hidden p-4 mb-6 text-sm rounded-lg" role="alert"></div>
                        <div class="flex justify-center mb-8">
                            <label for="trades-file" class="w-full md:w-1/1 flex flex-col justify-center items-center p-6 border-2 border-dashed border-border-color rounded-lg cursor-pointer hover:border-accent-primary transition-colors">
                                <svg class="mx-auto h-12 w-12 text-text-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>
                                <span id="trades-file-name" class="mt-2 text-sm font-semibold text-text-primary">Relatório de Operações (.csv)</span>
                            </label>
                            <input type="file" id="trades-file" accept=".csv" class="hidden"/>
                        </div>
                        <div class="important-note mb-8">
                            <p>MUITO IMPORTANTE:</p>
                            <p class="mt-1 text-sm">Certifique-se de que o relatório está no formato CSV (separado por vírgula). Neste campo NÃO são considerados os envios e retiradas de capital (margem para operar).</p>
                        </div>
                        <div class="flex justify-center">
                            <button id="process-button" class="btn btn-primary text-base py-2 px-8">
                                <span id="button-text">Processar Dados</span>
                                <div id="loader" class="loader !w-6 !h-6 hidden ml-3"></div>
                            </button>
                        </div>
                    </section>

                    <section id="results" class="hidden mt-12"></section>
                </div>

                <div id="main-content-wrapped" class="main-content hidden">
                    <!-- O conteúdo do wrapped será inserido aqui pelo JavaScript -->
                </div>
            </main>

        </div>
    </div>

    <!-- ======================================================================= -->
    <!-- ELEMENTOS FLUTUANTES E MODAIS -->
    <!-- ======================================================================= -->

    <div id="auth-container" style="display: none;" class="no-print">
        <span id="user-email" class="text-text-primary text-sm font-medium"></span>
        <button id="sign-out-button" class="text-xs text-negative-color hover:text-red transition-colors">Sair</button>
    </div>

    <div id="trades-modal" class="modal-overlay no-print">
        <div class="modal-content !w-full max-w-lg sm:max-w-xl md:max-w-2xl lg:max-w-3xl px-2 sm:px-6">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modal-title" class="text-2xl font-bold text-text-primary"></h2>
                <button id="close-modal-button" class="text-2xl text-text-secondary hover:text-text-primary transition-colors" aria-label=" Fechar modal">&times;</button>
            </div>
            <div class="overflow-x-auto rounded-lg border border-border-color" style="background: var(--surface-card, #f9fafb);">
                <table class="min-w-[500px] w-full divide-y divide-border-color text-[8px] sm:text-sm md:text-base">
                    <thead class="bg-surface-card/50">
                        <tr>
                            <th class="px-2 sm:px-4 py-3 text-left font-medium text-text-secondary uppercase tracking-wider whitespace-nowrap">Data</th>
                            <th class="px-2 sm:px-4 py-3 text-left font-medium text-text-secondary uppercase tracking-wider whitespace-nowrap">Ativo</th>
                            <th class="px-2 sm:px-4 py-3 text-right font-medium text-text-secondary uppercase tracking-wider whitespace-nowrap">Resultado (USD)</th>
                            <th class="px-2 sm:px-4 py-3 text-right font-medium text-text-secondary uppercase tracking-wider whitespace-nowrap">Resultado (BRL)</th>
                        </tr>
                    </thead>
                    <tbody id="modal-table-body" class="divide-y divide-border-color"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="tour-overlay" style="display: none;" class="no-print">
        <div class="tour-highlight"></div>
        <div class="tour-tooltip">
             <h3 id="tour-title" class="text-xl font-bold mb-2 text-text-primary"></h3>
             <p id="tour-text" class="text-base mb-4 text-text-secondary"></p>
             <div class="tour-nav">
                 <button id="tour-skip-btn" class="text-sm text-text-secondary hover:text-text-primary">Pular</button>
                 <div class="flex items-center gap-3">
                     <span id="tour-step-counter" class="text-sm text-text-secondary"></span>
                     <button id="tour-prev-btn" class="btn btn-secondary !py-1.5 !px-3 !text-xs">Anterior</button>
                     <button id="tour-next-btn" class="btn btn-primary !py-1.5 !px-3 !text-xs">Próximo</button>
                 </div>
             </div>
        </div>
    </div>

    <div id="terms-modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="terms-text-container">
                <h4>&gt;&gt; Termos Legais, Condições e Avisos &lt;&lt;</h4>
                <p>Ao utilizar as planilhas, ferramentas, e ao fazer uso das informações contidas no projeto IR, o usuário confirma que leu, entendeu e aceitou os termos, condições e avisos aqui listados.</p>
                <p><strong>17 -</strong> Qualquer cliente que esteja tendo dificuldades com a apuração nas planilhas, ferramentas e informações contidas no Projeto IR poderá solicitar auxílio da equipe responsável, que providenciará a resposta adequada, se possível, com a maior brevidade possível dentro do razoável. Caso o cliente, mesmo após a ajuda, não consiga apurar seu imposto corretamente.</p>
            </div>
            <div class="flex justify-end items-center gap-4 mt-auto pt-6 border-t border-border-color">
                <button id="decline-terms-btn" class="btn btn-danger">Recusar e Sair</button>
                <button id="accept-terms-btn" class="btn btn-primary">Li, entendi e aceito os termos</button>
            </div>
        </div>
    </div>

    <div id="export-modal" class="modal-overlay no-print">
        <div class="modal-content !w-[500px]">
            <div class="flex justify-between items-center mb-6">
                <h2 id="export-modal-title" class="text-2xl font-bold text-text-primary">Exportar Relatório</h2>
                <button id="close-export-modal-btn" class="text-2xl text-text-secondary hover:text-text-primary transition-colors" aria-label=" Fechar modal de exportação">&times;</button>
            </div>
            <div class="space-y-6">
                <div>
                    <label for="export-format-select" class="block text-sm font-medium mb-2 text-text-secondary">Formato do Arquivo</label>
                    <select id="export-format-select" class="input-field">
                        <option value="pdf">PDF (.pdf)</option>
                        <option value="xlsx">Excel (.xlsx)</option>
                    </select>
                </div>
                <div>
                    <p class="block text-sm font-medium mb-3 text-text-secondary">Conteúdo a Incluir</p>
                    <div id="export-options-container" class="space-y-3"></div>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-border-color flex justify-end">
                <button id="generate-export-btn" class="btn btn-primary">
                    <span id="export-btn-text">Gerar e Baixar</span>
                    <div id="export-loader" class="loader !w-5 !h-5 hidden ml-2"></div>
                </button>
            </div>
        </div>
    </div>
    

    <script type="module" src="script.js"></script>

</body>
</html>
